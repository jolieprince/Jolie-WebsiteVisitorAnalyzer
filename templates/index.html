<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitor Traffic Quality Analyzer</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="bg-dark text-light">
    <div class="container-fluid py-4">
        <!-- Header -->
        <header class="text-center mb-5">
            <h1 class="display-4 fw-bold mb-2">
                <i class="bi bi-shield-check text-primary"></i>
                Visitor Traffic Quality Analyzer
            </h1>
            <p class="lead text-muted">Real-time visitor authenticity & bot detection system</p>
        </header>

        <!-- Loading Screen -->
        <div id="loadingScreen" class="text-center py-5">
            <div class="spinner-border text-primary mb-4" style="width: 5rem; height: 5rem;" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h3 class="mb-3">
                <i class="bi bi-cpu me-2"></i>
                Analyzing Visitor...
            </h3>
            <p class="text-muted mb-4">Performing comprehensive security analysis</p>
            <div class="progress mx-auto" style="max-width: 500px; height: 30px;">
                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
                     role="progressbar" style="width: 0%">0%</div>
            </div>
            <div class="mt-4">
                <small class="text-muted" id="loadingStatus">Initializing analysis...</small>
            </div>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" style="display: none;">

            <!-- Overall Risk Assessment -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-0 shadow-lg">
                        <div class="card-body">
                            <h2 class="card-title mb-4">
                                <i class="bi bi-activity me-2"></i>
                                Overall Risk Assessment
                            </h2>
                            <div class="row g-4">
                                <div class="col-md-3">
                                    <div class="text-center p-3 rounded" id="riskScoreCard">
                                        <h6 class="text-muted mb-2">RISK SCORE</h6>
                                        <h1 class="display-3 fw-bold mb-0" id="riskScore">0</h1>
                                        <small class="text-muted">/ 100</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center p-3 rounded" id="visitorQualityCard">
                                        <h6 class="text-muted mb-2">VISITOR QUALITY</h6>
                                        <h3 class="fw-bold mb-0" id="visitorQuality">-</h3>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center p-3 rounded" id="genuineCard">
                                        <h6 class="text-muted mb-2">AUTHENTICITY</h6>
                                        <h3 class="fw-bold mb-0" id="genuineStatus">-</h3>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center p-3 rounded" id="confidenceCard">
                                        <h6 class="text-muted mb-2">CONFIDENCE</h6>
                                        <h3 class="fw-bold mb-0" id="confidence">0%</h3>
                                    </div>
                                </div>
                            </div>
                            <hr class="my-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5 class="text-danger mb-3">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        Red Flags <span class="badge bg-danger" id="redFlagCount">0</span>
                                    </h5>
                                    <ul class="list-unstyled" id="redFlagsList"></ul>
                                </div>
                                <div class="col-md-6">
                                    <h5 class="text-success mb-3">
                                        <i class="bi bi-check-circle me-2"></i>
                                        Green Flags <span class="badge bg-success" id="greenFlagCount">0</span>
                                    </h5>
                                    <ul class="list-unstyled" id="greenFlagsList"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Sections -->
            <div class="row g-4">

                <!-- Basic Information -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-info-circle me-2"></i>
                                Basic Information
                            </h4>
                            <table class="table table-dark table-sm" id="basicInfoTable"></table>
                        </div>
                    </div>
                </div>

                <!-- Header Analysis -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-list-ul me-2"></i>
                                HTTP Headers Analysis
                            </h4>
                            <div id="headerAnalysis"></div>
                        </div>
                    </div>
                </div>

                <!-- User Agent Analysis -->
                <div class="col-lg-12">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-browser-chrome me-2"></i>
                                User-Agent Analysis
                            </h4>
                            <div id="userAgentAnalysis"></div>
                        </div>
                    </div>
                </div>

                <!-- Browser Fingerprint -->
                <div class="col-lg-12">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="card-title mb-0">
                                    <i class="bi bi-fingerprint me-2"></i>
                                    Browser Fingerprint Analysis
                                </h4>
                                <button id="downloadFingerprintBtn" class="btn btn-sm btn-outline-primary" onclick="downloadCompleteFingerprint()">
                                    <i class="bi bi-download me-1"></i>
                                    Download Full Fingerprint
                                </button>
                            </div>
                            <div id="fingerprintAnalysis"></div>
                        </div>
                    </div>
                </div>

                <!-- Proxy/VPN Detection -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-shield-x me-2"></i>
                                Proxy/VPN Detection
                            </h4>
                            <div id="proxyVpnDetection"></div>
                        </div>
                    </div>
                </div>

                <!-- Automation Detection -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-robot me-2"></i>
                                Automation Detection
                            </h4>
                            <div id="automationDetection"></div>
                        </div>
                    </div>
                </div>

                <!-- Consistency Checks -->
                <div class="col-lg-12">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-check2-square me-2"></i>
                                Consistency Checks
                            </h4>
                            <div id="consistencyChecks"></div>
                        </div>
                    </div>
                </div>

                <!-- Threat Indicators -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-exclamation-octagon me-2"></i>
                                Threat Indicators
                            </h4>
                            <div id="threatIndicators"></div>
                        </div>
                    </div>
                </div>

                <!-- Behavioral Signals -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-person-check me-2"></i>
                                Behavioral Signals
                            </h4>
                            <div id="behavioralSignals"></div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Mouse Tracking -->
                <div class="col-lg-12">
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-mouse me-2"></i>
                                Advanced Mouse & Click Analysis
                            </h4>
                            <div id="advancedMouseTracking"></div>
                        </div>
                    </div>
                </div>

                <!-- Keyboard & Scroll Behavior -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-keyboard me-2"></i>
                                Keyboard & Scroll Behavior
                            </h4>
                            <div id="keyboardScrollBehavior"></div>
                        </div>
                    </div>
                </div>

                <!-- Timing Analysis -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-stopwatch me-2"></i>
                                Timing Analysis
                            </h4>
                            <div id="timingAnalysis"></div>
                        </div>
                    </div>
                </div>

                <!-- Virtual Machine Detection -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-pc-display me-2"></i>
                                Virtual Machine Detection
                            </h4>
                            <div id="vmDetection"></div>
                        </div>
                    </div>
                </div>

                <!-- Browser Extensions -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-puzzle me-2"></i>
                                Browser Extensions
                            </h4>
                            <div id="browserExtensions"></div>
                        </div>
                    </div>
                </div>

                <!-- CSS Media Queries -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-palette me-2"></i>
                                CSS Media Features
                            </h4>
                            <div id="cssMediaQueries"></div>
                        </div>
                    </div>
                </div>

                <!-- Speech & Client Hints -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow h-100">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="bi bi-soundwave me-2"></i>
                                Speech Synthesis & Client Hints
                            </h4>
                            <div id="speechClientHints"></div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Refresh Button -->
            <div class="text-center mt-5">
                <button class="btn btn-primary btn-lg" onclick="location.reload()">
                    <i class="bi bi-arrow-clockwise me-2"></i>
                    Analyze Again
                </button>
            </div>

        </div>

    </div>

    <!-- Footer -->
    <footer class="text-center py-4 mt-5 border-top border-secondary">
        <p class="text-muted mb-0">
            <i class="bi bi-shield-lock me-2"></i>
            Visitor Traffic Quality Analyzer | Real-time Bot & Fraud Detection
        </p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/fingerprint.js') }}"></script>
    <script src="{{ url_for('static', filename='js/fingerprint_advanced.js') }}"></script>
    <script src="{{ url_for('static', filename='js/fingerprint_complete.js') }}"></script>
    <script src="{{ url_for('static', filename='js/analysis.js') }}"></script>

    <!-- Complete Fingerprint Download Function -->
    <script>
        let completeFingerprint = null;

        // Function to download complete fingerprint
        async function downloadCompleteFingerprint() {
            const btn = document.getElementById('downloadFingerprintBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="bi bi-hourglass-split me-1"></i> Collecting...';

            try {
                const collector = new CompleteBrowserFingerprint();
                completeFingerprint = await collector.collect();

                // Add headers from current request (will be added by server)
                completeFingerprint.headers = window.location.href;

                // Download the file
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];
                const filename = `fingerprint_${timestamp}.json`;
                collector.downloadAsJSON(filename);

                btn.innerHTML = '<i class="bi bi-check-circle me-1"></i> Downloaded!';
                btn.classList.remove('btn-outline-primary');
                btn.classList.add('btn-success');

                setTimeout(() => {
                    btn.innerHTML = '<i class="bi bi-download me-1"></i> Download Full Fingerprint';
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-primary');
                    btn.disabled = false;
                }, 3000);

            } catch (error) {
                console.error('Error collecting fingerprint:', error);
                btn.innerHTML = '<i class="bi bi-x-circle me-1"></i> Error';
                btn.classList.remove('btn-outline-primary');
                btn.classList.add('btn-danger');

                setTimeout(() => {
                    btn.innerHTML = '<i class="bi bi-download me-1"></i> Download Full Fingerprint';
                    btn.classList.remove('btn-danger');
                    btn.classList.add('btn-outline-primary');
                    btn.disabled = false;
                }, 3000);
            }
        }
    </script>
</body>
</html>
